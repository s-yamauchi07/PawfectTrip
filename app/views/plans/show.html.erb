
<h2 class="mb-4 text-center text-2xl font-bold text-gray-800 md:mb-6 lg:text-3xl">日程詳細</h2>

<!-- top -->
<section class="text-gray-600 body-font overflow-hidden">
  <div class="py-6 sm:py-8 lg:py-12">
  <div class="mx-auto max-w-screen-xl px-4 md:px-8">
    <div class="grid gap-8 md:grid-cols-2 lg:gap-12">
      <div class="relative">
        <div class="h-64 overflow-hidden rounded-lg bg-gray-100 shadow-lg md:h-auto">
          <%= image_tag @plan.cover_image, loading:"lazy", alt:"cover_image", class:"h-full w-full object-cover object-center" %>
        </div>
        <button class="rounded-full w-10 h-10 bg-gray-200 p-0 border-0 inline-flex items-center justify-center text-gray-500 ml-4 absolute top-2 right-2">
          <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-5 h-5" viewBox="0 0 24 24">
            <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"></path>
          </svg>
        </button>
      </div>

      <div class="md:pt-8">
        <div class="flex">
          <p class="text-center font-bold text-indigo-500 md:text-left"><%= "#{@plan.user.nickname}'s trip plan" %></p>
          <div class="flex justify-center">
            <% if current_user == @plan.user%>
              <button>編集</button>
              <button>削除</button>
            <% end %>
          </div>
        </div>
        <h1 class="mb-4 text-center text-2xl font-bold text-gray-800 sm:text-3xl md:mb-6 md:text-left"><%= @plan.title%></h1>

        <div class="mb-6 text-gray-500 sm:text-lg md:mb-8">
          <div class="flex mb-4">
            <a class="flex-grow text-blue-500 border-b-2 border-blue-500 py-2 text-lg px-1">日程詳細</a>
          </div>
          <div class="flex border-gray-200 py-2">
            <span class="text-gray-500">旅行日程</span>
            <span class="ml-auto text-gray-900"><%= l @plan.departure_date, format: :short %>~<%= l @plan.return_date, format: :short%></span>
          </div>
          <div class="flex border-t border-gray-200 py-2">
            <span class="text-gray-500">出発地</span>
            <span class="ml-auto text-gray-900"><%= Prefecture.find(@plan.departure_id).name %></span>
          </div>
          <div class="flex border-t border-b border-gray-200 py-2">
            <span class="text-gray-500">目的地</span>
            <span class="ml-auto text-gray-900"><%= Prefecture.find(@plan.destination_id).name %></span>
          </div>
          <div class="flex border-t border-b border-gray-200 py-2">
            <span class="text-gray-500">同伴者</span>
            <span class="ml-auto text-gray-900"><%= @plan.companion.name %></span>
          </div>
          <div class="flex border-t border-b mb-6 border-gray-200 py-2">
            <span class="text-gray-500">同伴わんこ</span>
            <span class="ml-auto text-gray-900"><%= Pet.find_by(user_id: @plan.user.id).name %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <div class="container px-5 py-24 mx-auto">

    <!-- 日程のコンテンツ -->
    <% if @plan.itineraries.present? %>
      <div class="flex justify-center items-center">
        <div class="w-1/2 px-5 py-24 mx-auto">
          <div data-controller="tab" data-tab-default-tab-value="<%= @itineraries.keys.min if @itineraries.present? %>">
            <!-- タブ名-->
            <ul class="tab-list tabs tabs-boxed">
              <% @unique_date.each do |date| %>
                <li class="tab" data-tab-target="tab" data-action="click->tab#click" id="<%= date[0]%>"><%= date[0]  %></li>
              <% end %>
            </ul>
            <!-- タブ名-->

            <% total_index = 0%>
            <!-- タブのコンテンツ-->
            <% @itineraries.each do |date, itineraries| %>
              <ul data-tab-target="card" id="<%= date %>">
                <% itineraries.each do |itinerary| %>
                <% total_index += 1 %>
                  <li class="mt-4">
                    <div class="p-4 mb-4 border border-solid border-gray-200 rounded-xl indicator">
                      <span class="indicator-item indicator-start badge badge-primary"><%= total_index %></span>
                      <%= l itinerary.date, format: :only_time %>
                      <%= itinerary.place %>
                      <p><%= itinerary.memo %></p>
                    </div>
                    <div class="flex items-center">
                    <!--その日の最後の予定の場合は移動アイコンを表示させない-->
                    <% unless itinerary == itineraries.last %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0 0l6.75-6.75M12 19.5l-6.75-6.75" />
                      </svg>
                        <%= image_tag Transportation.find(itinerary.transportation_id).image, class:"w-8 ml-4"%>
                      </div>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            <% end %>
            <!-- タブのコンテンツ-->
          </div>
        </div>
        <div id="map" class="w-96 h-96">
        </div>
      </div>
    <% end %>
  </div>
</section>